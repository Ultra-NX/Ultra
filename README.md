# Ultra 1.5 by **[redraz](https://github.com/redraz)**

### If someone translates the information from this page into English (Possible with GPT-4), I will gladly add README_ENG.md

[Группа в телеграме](@UltraNX)

![](https://github.com/Ultra-NX/Ultra-Resources/raw/main/Ultra.png)

**ВНИМАНИЕ! Над инструкцией все еще ведется работа! Пулреквесты с исправлениями и дополнениями приветствуются. Пользователям Mac OS, в случае возникновения проблем - прочитать [гайд](https://gbatemp.net/threads/macos-fix-archive-attributes-for-switch-sd-card.545560/)** 
### За образец инструкции взят репозиторий [4IFIR](https://github.com/rashevskyv/4IFIR)

Инструкция обширная. Используйте поиск для того, чтобы успешно ей пользоваться. 

Сборник модифицированных компонентов, призванный максимально упростить разгон Nintendo Switch, а также улучшить пользовательский опыт за счет дополнительного функционала.
Модификация предназначена для тех, кто хотел бы выжать максимум из своей консоли, добиться графики уровня PS4 (рекомендуется использовать в связке с [модами ув. ECLIPSE00074](https://4pda.to/forum/index.php?showuser=176532)), разблокировать 60fps, ускорить загрузки, зафиксировать нативное разрешение, снизить шум системы охлаждения и т.д. 

В случае с пакетами разгона в Ultra, подразумевается не разблокировка частот в пределах штатных таблиц, а именно что разгон, включающий undervolting/overvolting каждого разгоняемого компонента. Устанавливая пакеты разгона без теоретической подготовки, вы снимаете с автора ответственность за любые возможные последствия, включая выход консоли из строя, и полностью берете риски на себя. Абсолютно безопасным разгон быть не может по определению, вас предупредили. От потенциальных программных проблем вас застрахует использование EmuNand, FAT32 и наличие бекапов. Во-избежание конфликтов, рекомендуется проводить установку начисто.

## Содержание 

1. [Особенности Ultra](#особенности-ultra)
1. [Состав Ultra](#состав-Ultra)
1. [Установка](#установка)
   * [Установка (с кефира, чифира или другой сборки)](#установка-с-кефира-чифира-или-другой-сборки)
   * [Обновление (переход с предыдущих версий), переустановка начисто](#обновление-переход-с-предыдущих-версий-переустановка-начисто)
   * [Дополнительные методы](#дополнительные-методы)
1. [Как использовать Ultra](#как-использовать-ultra)
   * [Включение и отключение модулей](#включение-и-отключение-модулей)
   * [Управление режимом работы консоли (портатив\док, ReverseNX-RT)](#управление-режимом-работы-консоли-портатив--док-reversenx-rt)
   * [Разгон](#разгон)
      * [Настройки частот и говернор (governor)](#настройки-частот-и-говернор-governor)
      * [Конфигуратор Ultra Tuner](#конфигуратор-ultra-tuner)
      * [Пресеты](#пресеты)
   * [Выжимаем больше - читы и патчи на улучшение графики](#выжимаем-больше---читы-и-патчи-на-улучшение-графики)
      * [Читы](#читы)
      * [Модификации](#модификации)
      * [FPSLocker](#fpslocker)
   * [Оптимизация работы, выбор подходящих частот и энергопотребление](#оптимизация-работы-выбор-подходящих-частот-и-энергопотребление)
1. [Проблемы и их решения](#проблемы-и-их-решения)
   * [Проблемы с батареей](#проблемы-с-батареей)
      * [Батарея начала разряжаться до 1% со 100% за считаные минуты, однако без проблем работает на 1% несколько часов](#батарея-начала-разряжаться-до-1-со-100-за-считаные-минуты-однако-без-проблем-работает-на-1-несколько-часов)
      * [При игре с включенным разгоном через некоторое время показывается значок пустой батареи](#при-игре-с-включенным-разгоном-через-некоторое-время-показывается-значок-пустой-батареи)
      * [Игра перестала запускаться и стала вылетать](#игра-перестала-запускаться-и-стала-вылетать)
      * [FPS в игре всегда показывает 0/254 или ReverseNX не переключает режимы](#fps-в-игре-всегда-показывает-0254-или-reversenx-не-переключает-режимы)
1. [FAQ](#faq)
1. [Лицензии](#лицензии)
1. [Благодарности](#благодарности)
1. [Поддержка](#поддержка)

## Особенности Ultra

* Предварительно настроенный OC-Suite с пресетами.
* Потрясающий и вервый на Свитче - Ultra Tuner, позволяющий настраивать разгон прямо с консоли.
* Сборка максимально легкая и не нагруженная. В ней нет лишнего, минимум необходимый для разгона и все.
* Модульная конструкция. В стоке минимум приложений/плагинов/оверлеев, но вы всегда можете поставить еще через комплектный апдейтер.
* Выбор пресета работы системы охлаждения, либо шумно но холодно, либо тихо но горячо.
* Кастомный Status Monitor Overlay c FPS и системными метриками.
* Ускоренная зарядка.

### Плюсы систем разгона 4ifir/Suite
* Разгон вплоть до значений в 2907+ Mhz для CPU, 1305 Mhz для GPU, 29xx Mhz для RAM (точный потолок значения индивидуален для каждой консоли)
* Автоматический андервольтинг/овервольтинг
* Автоматический буст при загрузке игры
* Поддержка говернора - снижения потребления ресурсов когда они не требуются консоли (Временно недоступно на 17 HOS)

## Состав Ultra

1. **[Atmosphere](https://github.com/Atmosphere-NX/Atmosphere)**
1. **[Сигпатчи](https://sigmapatches.coomer.party)**
1. **[Hekate](https://github.com/CTCaer/hekate)**
1. **Установленные пейлоады**:
   * [Lockpick_RCM](https://github.com/shchmue/Lockpick_RCM) - программа для дампинга ключей консоли.
   * [TegraExplorer](https://github.com/rashevskyv/TegraExplorer/) - низкоуровневый файловый менеджер для работы с системой.
1. **Установленное Homebrew**
   * [AiO Switch Updater](https://github.com/HamletDuFromage/aio-switch-updater) - программа для обновления Ultra до актуальной версии, а так же для скачивания читов.
   * [DBI](https://github.com/rashevskyv/dbi) - лучший файловый менеджер, менеджер сохранений и установщик программ на консоль.
1. **Доступные для скачивания Homebrew**
   * [Homebrew App Store](https://github.com/fortheusers/hb-appstore) - магазин приложений
   * [Linkalho](https://github.com/rdmrocha/linkalho) - программа для привязки аккаунта.
   * [Battery Desync Fix](https://github.com/CTCaer/battery_desync_fix_nx) - программа для сброса контроллера батареи. Не используйте просто так!
   * [Daybreak](https://github.com/Atmosphere-NX/Atmosphere/tree/master/troposphere/daybreak) - программа для обновления системного ПО.
   * [SysDVR](https://github.com/exelix11/SysDVR) - программа для передачи изображения с консоли на ПК или другие устройства.
   * [sys-ftpd](https://github.com/cathery/sys-ftpd) - FTP сервер, работающий в фоне.
   * [Observer-Tool](https://github.com/rkuchkarov/Observer-Tool) - оверлей с максимально подробным отображением статистики системы, напоминает Afterburner на PC.
   * MicroMemBench - бенчмарк памяти. Результат сильно зависит от разгона CPU. В версии 0.5.0 нету принудительного авторазгона CPU, в 0.5.1 - есть.
   * MicroMemTest - тест памяти. Проводить только с максимальным разгоном CPU. Если ошибки на Loop ниже 20 - значит с разгоном RAM точно проблемы.
   * mhz - программа показывающая честную максимальную частоту цпу.
   * RaytracingNX - бенчмарк цпу.
1. **Установленные модули**
   * [SaltyNX](https://github.com/masagrator/SaltyNX) - фоновый модуль, позволяющий модифицировать файлы\процессы в консоли, поддерживает плагины. Не совместим с 32-х битными играми (список на гитхабе проекта).
   * [ReverseNX-Tool](https://github.com/masagrator/ReverseNX-Tool) - (Теперь вшита в SaltyNX) программа, которая принудительно меняет режимы работы консоли на докстанцию и портатив, вне зависимости от того  находится консоль в доке или нет. Потенциально улучшает картинку в портативе за счет того, что рендерит изображение так, как будто консоль в докстанции. 
   * [Ultra](https://github.com/Ultra-NX/Ultra-Overlay), форк [sys-clk-oc](https://github.com/hanai3Bi/Switch-OC-Suite) - модуль отвечающий за разгон процессора, памяти и видеочипа, для лучшей производительности. Используется сразу несколько вариаций от разных авторов, все модифицированные. Оригинальные авторы: Meha/hanai3Bi, lineon, p-sam.
   * [nx-ovlloader](https://github.com/WerWolv/nx-ovlloader/) - с помощью этого модуля осуществляется переключение установленных модулей.
   * [sys-patch](https://github.com/ITotalJustice/sys-patch/) - создает/обновляет патчи при запуске системы. Не заменяет сигпатчи, но избавляет от регулярного ручного обновления патчей системы после каждой микрообновы системы.
   * [Ultra Paw Overlay](https://github.com/Ultra-NX/Ultra-Paw-Overlay), форк [Ultrahand Overlay](https://github.com/ppkantorski/Ultrahand-Overlay) - специальное оверлей-меню для взаимодействия с системой: разгон, управление режимами через ReverseNX, включение читов, прочее. Так же позволяет использовать самописные пакеты, как - Ultra Tuner.
     - [FPSLocker](https://github.com/masagrator/FPSLocker) - оверлей, позволяющий разблокировать 60 FPS в играх.
     - [EdiZon](https://github.com/proferabg/EdiZon-Overlay/releases) - оверлей для использования читов.
     - [ovlSysmodules](https://github.com/WerWolv/ovl-sysmodules/) - оверлей для включения и отключения установленных системных модулей.
     - [InfoNX-ovl](https://github.com/renA21/InfoNX/) - оверлей, показывающий информацию о батарее/CPU/GPU/RAM.
     - [Ultra-Status-Monitor](https://github.com/Ultra-NX/Ultra-Status-Monitor), форк [Status-Monitor-Overlay](https://github.com/masagrator/Status-Monitor-Overlay) - модуль для контроля параметров консоли в реальном времени. Может выступать в качестве  счетчика FPS.
1. **Пакеты Разгона**
   * [OC-Suite](https://github.com/hanai3Bi/Switch-OC-Suite/) - Пакет разгона от Meha/hanai3Bi, открытые исходники (Были до недавнего времени) гарантируют надежность и отсутствие скрытых гадостей. Вовремя обновляется для поддержки новых возможностей Атмосферы. Используется модифицированный loader.kip от B3711, в котором больше таблица андервольта CPU (6 уровней против 2х).
   * С версии 1.5.2 другие пакеты были убраны, так как не поддерживают HOS 17, и уступают OC-Suite во всем.

## Установка 

**ВАЖНО! Строго следуйте инструкции и не отклоняйтесь от нее. В случае возникновения проблем, вернитесь к инструкции и переустановите Ультру начисто.**

### Установка (с кефира, чифира или другой сборки)
1. Распакуйте [All in One Updater с конфигом Ultra](https://github.com/Ultra-NX/Ultra-Resources/raw/main/aio/config.zip) на карту памяти консоли
1. Запустите [**Homebrew Launcher**] (Зажав R зайти в игру/альбом) > **All in One Updater**
   * Если вместо запуска приложения вы получаете черный экран, немного подождите, и если не помогло - перекачайте приложение вручную из его [репозитория](https://github.com/HamletDuFromage/aio-switch-updater) и распакуйте [архив с конфигом](https://github.com/Ultra-NX/Ultra-Resources/raw/main/aio/config.zip) в корень карты памяти.
1. Перейдите в **Custom Downloads** > **Ultra** > **Continue**, на запрос о перезаписи `ini`, выберите **Yes**, консоль перезагрузится

### Обновление (переход с предыдущих версий)
1. Запустите [**Homebrew Launcher**] (Зажав R зайти в игру/альбом) > **All in One Updater**
   * Если вместо запуска приложения вы получаете черный экран, немного подождите, и если не помогло - перекачайте приложение вручную из его [репозитория](https://github.com/HamletDuFromage/aio-switch-updater) и распакуйте [архив с конфигом](https://github.com/Ultra-NX/Ultra-Resources/raw/main/aio/config.zip) в корень карты памяти.
1. Перейдите в **Custom Downloads** > **Ultra** > **Continue**, на запрос о перезаписи `ini`, выберите **Yes**, консоль перезагрузится

### Дополнительные методы
* **Установка с нуля** нужна _только_ тем, у кого не стоит никакой системы вообще, но уже есть возможность запустить её с карты памяти (например, установлен чип).
* **Отладочная установка** это метод, который следует использовать _только_ тогда, когда понимаете, что делаете, или если об этом вас попросили компетентные люди в чате.
   
#### Установка с нуля
1. Распакуйте [Ultra](https://github.com/Ultra-NX/Ultra/releases/latest/download/Ultra.zip) на карту памяти консоли
   * Карта должна быть в [FAT32]
   * Работать с картой памяти рекомендуется через картридер, не через консоль.
1. Вставить карту в консоль и включить

#### Отладочная установка
**Выполняйте только в случае проблем с методами выше**
1. Удалите с карты памяти всё, кроме папки Nintendo и emuMMC (если есть) (Папку с бекапами сохранений, например JKSV, тоже не стоит удалять, а стоит скопировать в безопасное место на компьютере)
   * Карта должна быть отформатирована в [FAT32], размер кластера 64kb. Если стандартными методами форматирования вам не дают выбрать нужную файловую системы - используйте [Rufus](https://rufus.ie/ru/). Система HOS свитча не умеет правильно работать с [EXFAT], потому будет быстро убивать карту памяти бесконечными циклами перезаписи.
   * Работать с картой памяти рекомендуется через картридер, не через консоль.
2. Распакуйте [Ultra](https://github.com/Ultra-NX/Ultra/releases/latest/download/Ultra.zip) на карту памяти консоли
3. Вставить карту в консоль и включить

## Как использовать Ultra 

Все настройки осуществляются через Ultra Paw меню, которое вызывается сочетанием клавиш (L)+(R)+(▲), где (L) - верхний бампер левого джойкона, (R) - верхний бампер правого джойкона, а (▲) - кнопка вверх на "крестовине". 

**Можете установить любую комбинацию с помощью Ultra Tuner, или просто удалить файл `/config/ultrapaw/config.ini`, в таком случае вернется комбинация по умолчанию.**

После одновременного нажатия этих трех кнопок появится Ultra Paw меню со следующими пунктами: 

* **Ultra Overlay** - модуль для управления профилями разгона
* **Status Monitor** - модуль, показывающий метрики работы системы в реальном времени поверх экрана, не отбирая управление у игры. Есть много режимов работы, в том числе режим, позволяющий вывести счетчики частот и FPS в левом верхнем углу экрана
* **FPSLocker** - модуль для разблокировки 60 fps в играх
* **InfoNX** - модуль, показывающий расширенную информацию о потреблении энергии консоль
* **ReverseNX-RT** - модуль, позволяющий принудительно выбрать режим работы консоли (портативный или докстаниця)
* **EdiZon** - модуль для управления читами 
* **Sysmodules** - модуль, для управления модулями. Позволяет включать\отключать установленные модули

Нажав **(A)** на пункте, вы откроете его персональное меню.

### Включение и отключение модулей 

Модуль **Sysmodules** позволяет включать и выключать выбранные модули, а так же управлять их автозагрузкой. Имейте ввиду, что некоторые модули можно включать и выключать без перезагрузки, однако ряд модулей после включения требуют перезагрузки консоли. 

Справа от названия модуля указано его состояние, например **On | х**, где On говорит о текущем состоянии модуля (On - включен, Off - выключен), а **х** о том стоит ли модуль в автозагрузке (**х** - не стоит, **иконка домика** - стоит). 

Кнопкой **(A)** можно включить или выключить модуль. Кнопка (Y) включает или выключает автозагрузку модуля. Если при нажатии на кнопку (A) модуль не меняет своё состояние, значит им можно управлять только перезапуском консоли. Включите автозагрузку модуля и перезагрузите консоль, чтобы он начал работать, или выключите и перезагрузите, чтобы перестал. 

Модули, которые можно включать в любой момент сгруппированы сверху в группу **Dynamic**, а те, что требуют перезагрузки в группу **Static**.

### Сортировка и скрытие оверлеев

Кнопкой **(Y)** можно открыть настройки сортировки конкретного оверлея, где вы сможете его скрыть, что перенесет его в отдельное подменю скрытых оверлеев, либо выбрать цифру приоритета. Чем ниже цифра, тем выше в списке будет конкретный оверлей.

### Управление режимом работы консоли (портатив \ док, ReverseNX-RT)

Модуль **ReverseNX-RT** позволяет принудительно включать режим докстанции при игре в портативе и наоборот. С помощью кнопки **Change system control** нужно включить принудительное управление сменой режимов (отображается в строке **Controlled by system**, положение **No** означает, что можно менять режимы вручную). После чего можно переключать режимы кнопкой Change mode (отображается в строке **Mode**, где **Docked** - режим докстанции, **Handheld** - портатив).

Важно понимать, что в режиме докстанции повышается разрешение и выставляются более высокие настройки графики игры, вшитые разработчиками, за счет чего картинка становится более качественной, но и требуется больше разгон, и батарея расходуется быстрее.

### Разгон 

В Ultra поставляется с встроенным пакетом разгона OC-Suite, но только в ультре вам доступны заранее подготовленные пресеты настроек разгона системы, благодаря чему вам не придется долго мучаться с цифрами таймингов и вольтажами. Благодаря открытым исходникам и работе целого сообщество над ним - он работает стабильнее и эффективнее чифира.

#### Настройки частот и говернор (governor)

Настройка разгона осуществляется через модуль Ultra Overlay.

В заголовке располагаются следующие параметры: 
* **App ID** - показывает titleid запущенной игры 
* **Profile** - параметр синхронизирован с настройками ReverseNX-RT (если включена соответствующая настройка в параметрах) и показывает в каком режиме сейчас работает консоль (**Docked** - режим докстанции, **Handheld** - портатив).
   * Синхронизация временно недоступна в новом sys-clk для HOS 17, но можно переключиться на старый sys-clk через настройки Tuner, если у вас HOS 16.1
* **CPU** - текущая частота процессора 
* **GPU** - текущая частота ядра видеопроцессора 
* **RAM** - текущая частота памяти 
* **SOC** - температура процессора (SoC - система на чипе, означает, что на одном чипе находится и видеоядро и центральный процессор, потому температура у них одна на двоих)
* **PCB** - температура контроллера питания акумулятора
* **Skin** - температура платы консоли

* **Enable** - отвечает за активацию разгона. On - включен, Off - отключен 
* **Edit app Profile** - настройка профиля разгона для запущенного приложения. Указанные настройки будут автоматически применяться при запуске приложения. Имеют средний приоритет. 

* Advanced
   * **Temporary overrides** - настройки разгона для всех приложений. Указанные настройки применяются для всех запускаемых приложений и действуют до перезагрузки приставки. Имеют наивысший приоритет.
   * **Global profile** - настройки разгона для всех приложений. Указанные настройки применяются для всех запускаемых приложений. Имеют самый низкий приоритет. Использовать только если значете, что делаете.
   * **Miscellaneous** - дополнительные настройки консоли, например, ограничение вольтажа зарядки, автобуст, ограничение процента зарядки и другие. Подробнее будет рассмотрено отдельно.
      * Меню временно недоступно в новом sys-clk для HOS 17, но можно переключиться на старый sys-clk через настройки Tuner, если у вас HOS 16.1

Разгон осуществляется с помощью смены максимальной частоты для CPU/GPU/RAM через настройки разгона **Global profile**/**Edit app Profile**/**Temporary overrides**. Причем настройки будут применяться в зависимости от приоритета (**Temporary overrides** -> **Edit app Profile** -> **Global profile**). Наивысший приоритет у **Temporary overrides**, если там не указано никаких настроек, то программа смотрит в настройки из **Edit app Profile**, если там пусто, то применяются настройки из **Global profile**. И если уже там ничего нет, то ставятся настройки системы по-умолчанию (**Default**).

**Global profile** и **Edit app Profile** содержат разделение на профили: 
  * **Docked**
  * **Handheld**
  * **Charging**
  * **Official Charging**
  * **USB Charger** 

Профили имеют так же свой приоритет. От наивысшего к низшему: **Docked** -> **Official Charging** / **USB Charger** -> **Charging** -> **Handheld**. Принцип применения ровно такой же. Режим **Docked** имеет наивысший приоритет и перезаписывает значения профилей с приоритетом ниже. **Official Charging** или **USB Charger** имеют одинаковый приоритет и перезаписывают значения профилей **Charging** и **Handheld**, и так далее.

Профили **Docked** и **Handheld** синхронизированы с настройками Reverse-NX (можно отключить в **Miscellaneous** модуля **Ultra Overlay**) и зависят от режима работы консоли (док/портатив). Профиль **Charging** включается при подключении любой зарядки к консоли. Профиль **Official Charger** включается при подключении оригинальной зарядки, или любой другой, но с поддержкой протокола Power Delivery. Профиль **USB Charger**, при подключении любой другой зарядки. То есть, вы можете настроить отдельный профиль разгона для зарядки от любого источника и отдельно для мощного или маломощного, причем последние имеют приоритет выше. 

**Edit app Profile** содержит в себе управление говернорами

Говернор (англ. governor) в контексте управления частотами процессора - это программа или механизм, который контролирует частоту работы процессора и его потребление энергии.
   * Говернор временно недоступен в новом sys-clk для HOS 17, но можно переключиться на старый sys-clk через настройки Tuner, если у вас HOS 16.1

Суть работы говернора заключается в том, чтобы определить оптимальную частоту работы процессора в зависимости от нагрузки на него. Если процессор не нагружен, говернор может снизить его частоту, чтобы снизить потребление энергии и уменьшить тепловыделение. Если же процессор получает высокую нагрузку, говернор может увеличить его частоту до выставленной в профиле, чтобы обеспечить высокую производительность.

* **CPU Freq Governor** - включить или выключить управление частотой **центрального** процессора
* **GPU Freq Governor** - включить или выключить управление частотой **графического** процессора

Оба эти пункта будут доступны только если в **Miscellaneous** активировано значение **Frequency Governor**

Включенный говернор GPU в ряде игр может привести к подтормаживанию или снижению FPS (например, Metroid Prime Remastered иногда сбрасывает FPS до 30 при выходе из карты в игру). Если в вашей игре наблюдается такое, отключите говернор для GPU.

Каждый из профилей содержат в себе отдельные пункты для разгона **CPU**, **GPU** и **RAM**. Что за что отвечает легко понять по названию. В каждом из этих пунктов есть значение **Default**, которое отвечает за значение по-умолчанию, которое берется из предыдущей по приоритету настройки разгона (Temporary/App/Global/Системное значение) из профиля, соответствующего приоритета. Рабочие частоты подбираются индивидуально для каждой конкретной игры на каждой конкретной консоли. Подробнее про подбор частот будет ниже. 

* **Miscellaneous** - раздел с дополнительными настройками. Содержит в себе следующие опции:
   * **Auto CPU Boost** - активный слой автобуста. Повышает частоту CPU при нагрузке на системное ядро, что обычно означает подгрузку данных, стриминг текстур, локаций и т. п. На Erista лучше отключать, поскольку влияет на время работы от батареи
   * **Sync ReverseNX Mode** - настройка, синхронизирующая профиль ReverseNX с профилем Ultra Overlay. То есть, если в реверсе стоит **Handheld**, то активный профиль в Ultra Overlay будет **Handheld**, если **Docked**, то **Docked** соответственно
   * **Frequency Governor** - включает говерноры в **Edit app Profile**
   * **Charging Current** - ограничение тока зарядки
   * **Charging Limit** - ограничение до которого приставка будет заряжаться
   * **Force Disable Charging** - опция, позволяющая не заряжать батарею при работе от зарядки. То есть, батарея не будет садиться, но и фактически не будет заряжаться тоже. Позволяет избежать проблем с десинхронизацией батареи 
   * **Screen Backlight** - отключает подсветку экрана. Полезно в связке с sys-dvr 
   * **Info** - различные метрики: 
      * **Charger** - тип зарядного устройства, подключенного к консоли. Показывается вольтаж и ампераж, а так же мощность в Ваттах
      * **Battery** - напряжение на батарее и её температура
      * **Current Limit** - 
      * **Charging Limit** - значение, указанное в **Charging current**
      * **Raw Charge** - Заряд батареи, который отдает контроллер зарядки 
      * **Battery Age** - "здоровье" батареи
      * **Power Role** - 
      * **Current Flow** - текущее потребление 
      * **CPU Volt** - вольтаж CPU 
      * **GPU Volt** - вольтаж GPU 
      * **DRAM Volt** - вольтажи памяти

   * Раздел **Miscellaneous** временно недоступен в новом sys-clk для HOS 17, но можно переключиться на старый sys-clk через настройки Tuner, если у вас HOS 16.1

#### Конфигуратор Ultra Tuner

**Ultra Tuner** - это пакет, позволяющий произвести тонкую настройку параметров под свою консоль. В случае нестабильной работы пакетов разгона, или при желании увеличить производительность консоли, Ultra Tuner - Ваш незаменимый помощник.

Чтобы попасть в Ultra Tuner - откройте Ultra Paw меню комбинацией **(L)+(R)+(▲)**, после чего нажмите **(►)** чтобы попасть в меню пакетов, и выберите Ultra Tuner.

Внутри доступны следующие Страницы:
* **Tuner** - основное меню конфигурации, пресетов и бэкапов. 
* **Updater** - меню скачивания обновлений, приложений, модов и бонусом - изменения системных настроек атмосферы.


В Tuner находятся три основных раздела: 
* **CPU** - настройки процессора:
   * **Maximum MHz** - настройка максимальной частоты CPU. Не гарантирует, что в реальности ваш процессор будет держать такую частоту, что бы узнать реальную производительность, воспользуйтесь homebrew **mhz**
   * **Voltage Limit** - настройка максимального допустимого вольтажа CPU. Чем выше мощность - тем выше максимальная доступная частота процессора, однако выше и потребление. Высокие значения может не тянуть контроллер CPU, из-за чего будут вылеты в играх, или может не включаться консоль. Что бы включить консоль и опустить его вниз - выберите в Хекате Safe Mode.
   * **Undervolt Mode** - настройка, позволяющая задать глобальные параметры питания для CPU. Чем выше цифра, тем ниже потребление процессора, но могут возникнуть проблемы
* **GPU** - настройки видео-ядра:
   * **Undervolt Mode** - настройка, позволяющая задать глобальные параметры питания для видео-ядра. Сущетсвует три режима: 
      * Overvolt - увеличенное потребление видео-ядра. Позволяет добиться стабильности на более высоких частотах GPU/RAM, однако уменьшает автономность.
      * Base - стандартный режим Ultra.
      * Undervolt - режим экономного потребления видео-ядра. Увеличивает автономность, однако может быть нестабильным на некоторых консолях.
   * **Частоты GPU** - здесь представлены все частоты GPU, доступные в Ultra Overlay. Выбирая частоту, Вам на выбор будет предоставлен набор напряжений для этой частоты. Данная настройка позволяет тонко регулировать энергопотребление на конкретных частотах, давая возможность снизить потребление на низких частотах или повысить напряжение, если Вашей консоли не хватает стандартных настроек питания.
   **ВАЖНО:** при выставлении фиксированного напряжения на частоту, GPU Undervolt Mode будет неприменим к этой частоте.
   Внутри каждой частоты есть пункт Default, позволяющая Вам сбросить настройки на значения по умолчанию.
* **RAM** - настройки оперативной памяти:
   * **Maximum MHz** - настройка максимальной частоты памяти. При изменении данного параметра, частота выставляемая пунктом RAM Maximum будет заменена на выбранную. Чем выше частота - тем выше производительность, однако более высокие частоты могут привести к артефактам и вылетам при неправильной настройке сопутствующих параметров.
   * **Vddq Voltage** - первичный вольтаж памяти. Более высокие значения могут повысить стабильность на высоких частотах, оказывая минимальное влияние на энергопотребление. Только для Марико.
   * **Vdd2 Voltage** - вторичный вольтаж памяти. Более высокие значения также могут повысить стабильность на высоких частотах, оказывая минимальное влияние на энергопотребление. Для Эрист отвечает так же и за Vddq.
   * **EMC DVB Table** - таблица питания контроллера памяти. Гарантировано повышая стабильность на высоких частотах памяти. Чем выше значение - тем выше потребление. Рекомендуется повышать в первую очередь если у вас проблемы с разгоном RAM.
   * **Timing [0-7]** - настройки таймингов. Каждый пункт отвечает за свой набор таймингов, позволяя производить индивидуальную подгонку. Чем выше значение, тем выше производительность, однако слишком высокие значения могут привести к вылетам в зависимости от модели памяти. Для тонкой настройки - понизьте все значения до 1, после повышайте каждый параметр на единицу (с последующей перезагрузкой), проверяя стабильность. В случае вылета или артефактов - понизьте это значение на 1 и двигайтесь к следующему Core Timings пункту.
   Иногда вы можете видеть подобные обозначения таймингов: 85545553. Каждая цифра соответсвует настройке тайминга. Например, для случая выше: Timing 0 установлен на 8, Timing 1 - на 5 и так далее.

**ВАЖНО:** чтобы применить изменения - перезагрузите консоль.

В Ultra Tuner доступен механизм создания бекапов Ваших конфигураций. Для того чтобы управлять бекапами - зайдите в Backup Manager в главном меню Тюнера.
Внутри доступны три пункта:
* **Backup** - позволяет Вам создать новый бекап из текущей конфигурации. Бекапы расположены по пути */atmosphere/kips/.bak*. Новый бекап заменяет собой предыдущий
* **Restore** - восстановить конфигурацию из бекапа.
* **Delete** - удалить бекап файл.

#### Пресеты

Чем круче пресет, тем агрессивнее оптимизация таймингов/значений андервольтинга. Тем быстрее и энергоэффективнее игровая консоль. Стоковый Suite должен работать на почти любой консоли. Вероятность того, что у Вас заработают Mega/MK-4 и выше, зависит от [удачности процессорного бининга](https://www.computerra.ru/285384/dzhekpot-kremnievoj-loterei-chto-takoe-binning-protsessory/) конкретно вашей консоли.

Пресеты располагаются так: Core < Mega < Ultra < Red > Green > Blue > Gray
Пресеты Core/Mega/Ultra похожи на стейджи Base/ST/ST+ из Чифира, только более оптимизированные, и идущие у большего числа людей.
Пресеты Gray/Blue/Green/Red - эксклюзив Ultra, и тоже своего рода представляют аналоги стейджей Чифира, но со своими особенностями.
Gray - самый слабый пресет, если у вас не идет даже Core, но разгон использовать хочется - это ваш выбор.
Blue и Green аналоги ST и ST+, но с таймингами под Micron/Hynix
Red - самый крутой пресет, потому, что RED GOEZ FASTA!

Для выбора стабильного пресета нужно тестировать консоль следующим образом:

**ВНИМАНИЕ!!!** Если на каком-либо из этапов при тестировании стейджа произошло зависание, либо игра зависла, либо на экране появились артефакты, либо проявилось какое-либо неожиданное поведение консоли, понижайте пресет. Текущий ваша консоль не тянет!

1. Выберите максимальный из доступных пресетов в Тюнере, перезагрузитесь 
1. Отключите говерноры (**Ultra Overlay** > **Frequency Governor** > **Off**)
1. Выберите максимально доступную частоту памяти в **Temporary overrides**.
1. Если консоль не зависла, выберите максимально доступную частоту GPU в **Temporary overrides**
1. Если консоль не зависла, выберите максимально доступную частоту CPU в **Temporary overrides**
1. Если консоль не зависла, запустите любую тяжелую игру и протестируйте с ней минут 10-15. 
1. Если никаких глюков/глитчей/зависаний/артефактов не обнаружено, поздравляем, ваша консоль выиграла в кремниевой лотерее.

Вы можете добиться стабильной работы стейджа понизив частоты памяти или GPU. 

### Выжимаем больше - читы и патчи на улучшение графики 

#### Читы 

Помимо возможности включить режим докстанции при игре в портативе, можно дополнительно установить графические модификации для игр. Некоторые из них активируют большую частоту кадров, некоторые позволяют использовать производительность разогнанной консоли для улучшения отображаемой картинки, некоторые наоборот, улучшают производительность игры для стабильной работы на частотах без разгона. 

Читы для разблокировки 60FPS в некоторых играх можно взять в **AiO Updater** > **Download cheats** > **Download graphics enhancing cheats**. Если для установленных игр есть соответствующие читы, то они будут установлены автоматически. Помните что если для этих игр у вас уже были установлены читы, то установка читов для разблокировки удалит уже имеющиеся читы. Однако, если у вас есть читы для разблокировки FPS, то установка обычных читов через апдейтер просто добавит их, при этом сохранив читы на разблокировку. 

Активация читов проводится через меню **Tesla** > **EdiZon** > **Cheats** во включенной игре. В появившемся меню активируйте необходимый чит. После перезапуска игры, читы, что вы активировали ранее так же будут активны!

#### Модификации 

Моды для улучшения картинки нужно искать [на 4PDA](https://4pda.to/forum/index.php?act=findpost&pid=81825647&anchor=Spoil-81825647-8) или в телеграм-боте [Switch_library_bot](https://t.me/Switch_library_bot) по запросу `/mods` (пароль для бота - `alabama`).

Установка мода различается в зависимости от того как именно он сделан. 

* Если мод идет в виде LayeredFS папки, то его нужно класть в `/atmosphere/contents/%TitleID%/romfs`, где TitleID - title id вашей игры, состоящий из 16 символов в 16-тиричной системе исчисления (например, 01002CC003FE6000). Отнеситесь внимательно к тому как именно такая модификация распространяется и не допустите вложенности папок. Например, если вы видите что в архиве с модом папка `atmosphere`, то просто распакуйте ее в корень карты памяти и согласитесь на замену файлов. Если в архиве лежит папка с title id игры, поместите ее в папку `/atmosphere/contents/`. Убедитесь, что папка не дублируется (например `/atmosphere/contents/01002CC003FE6000/romfs` - правильно, а `/atmosphere/contents/01002CC003FE6000/01002CC003FE6000/romfs` или `/atmosphere/atmosphere/contents/01002CC003FE6000/romfs` - не правильно), иначе мод не будет работать. 
* Если мод идёт в виде IPS-патча, то есть в виде файла или файлов с расширением `*.ips`, то поместите его в папку `atmosphere/exefs_patches`. В папке `atmosphere/exefs_patches` можете создать папку с названием мода, это допускается. Если в архиве с модом есть просто папка `exefs_patches`, то поместите её с заменой в папку `atmosphere`. Часто моды могут комбинировать оба способа, тогда нужно понять что именно и куда копировать. Если вам что-то не понятно, попробуйте поискать информацию там, где вы эти моды качали или в текстовом файле, который может распространяться вместе с модом. 

Модификации установленные таким образом автоматически активируются при запуске игры. 

Помните, что важна версия игры для которой делалась модификация. Мод, сделанный для одной версии игры может не заработать на другой. 

Не стесняйтесь играть с частотами и использовать Status Monitor для достижения наилучшего стабильного результата!

#### FPSLocker

С помощью этого плагина можно разлочить частоту кадров в некоторых играх без использования читов. 

Метрики в заголовке: 
* **Большое число справа** - показывает, сколько кадров прошло за последнюю секунду для запущенной игры. Позволяет убедиться, что программа работает верно
* **Interval Mode** - внутреннее значение игрового движка на базе NVN API, может принимать значение **0**, **1** или ****2****. Меняя это значение мы можем изменить максимальное количество FPS в игре. **2** - 30 FPS, **1** - 60 FPS, **0 - значить у игры нет ограничения на количество FPS, либо используется другое API. 
* **Custom FPS Target** - показывает максимальное количество FPS для данной игры. Если игра использует собственные ограничения FPS движка, а не стандартное, то может быть невозможно разблокировать более 30 FPS без дополнительных патчей

Переключатели:
* **Increase/Decrease FPS target** - изменить целевое количество кадров в секунду с шагом в 5 FPS. **Минимум** - 15 FPS, **Максимум** - 60 FPS. Если FPS установлено более 30, то **Interval Mode** устанавливается на 1. В противном случае ставится 2.
* **Disable custom FPS target** - убирает ограничение FPS в зависимости от установленного **Interval Mode**. Если **Interval Mode** 2, то игра будет упираться в 30 FPS, если 1, то в 60. 
* **Sync Wait (!)** - это опасная настройка, которая в большинстве случаев будет приводить к падению игры (например, Witcher 3 и Breath of The Wild), но в некоторых случаях может принести пользу отключив двойную буферизацию, привнеся небольшие графические артефакты (например, Xenoblade Chronicles 3). Используйте с осторожностью. Рекомендуется держать **включенной**.
* **Save settings** - сохранить профиль для текущей запущенной игры, который будет автоматически загружен плагином при запуске в следующий раз. Не используйте эту функцию, если вы отключили синхронизацию (Sync Wait Off) и не проверили ее на безопасность, чтобы не пришлось вручную удалять сохраненный профиль. Профиль сохраняется в `SaltySD/plugins/FPSLocker/TITLEID.dat`

### Оптимизация работы, выбор подходящих частот и энергопотребление 

Чтобы достичь оптимальной производительности и избежать излишнего расхода энергии на вашем устройстве, нужно подобрать такие параметры частот, чтобы игра не тормозила и не более. Для этого рекомендуется использовать Status Monitor - инструмент, который позволяет отслеживать загрузку компонентов вашего устройства.

Для того, чтобы найти оптимальный баланс между производительностью и энергопотреблением, вы можете понизить (или повысить) частоты настройки в соответствии с результатами загрузки компонентов в Status Monitor. Найдите точку, где железо не загружено на 100%, но находится близко к этому уровню. Помните, что на свитче "узким горлышком" является память, при этом гонится она фактически бесплатно, то есть ее можно ставить на максимум при котором устройство работает стабильно, и это не повлияет на расход батареи. Чем выше стейдж, тем "дешевле" для консоли разгон памяти и тем он эффективнее. Гнать CPU обычно толку мало (но бывают и исключения). Поэтому, оптимальным вариантом с которого стоило бы начать, является максимальный разгон памяти и разгон CPU\GPU где-то на середину. Говерноры при этом рекомендуется отключить. Если игра при таком варианте тормозит, добавьте частоту GPU и делайте это до тех пор, пока тормоза не уйдут совсем. После этого включите говерноры. Если наблюдаются просадки FPS после их включения, отключите говернор GPU, поскольку часто именно он может приводить к просадкам. 

Не гонитесь за частотами и цифрами. Единственным мерилом удачного разгона является ваш комфорт при игре. Частоты не отражают фактической производительности, и тем более энергопотребления. Обратите внимание, что каждое устройство имеет уникальные характеристики, поэтому необходимо настраивать частоты в соответствии с конкретной моделью вашего устройства и играми, которые вы собираетесь запускать на нем. А каждая игра имеет уникальные требования. 

С помощью модуля **Status Monitor** можно следить за энергопотреблением консоли. Замеряйте потребление в тестируемой игре без разгона и с разгоном, а после найдите баланс между производительностью и энергопотреблением. Не забывайте, что чем выше потребление энергии, тем быстрее сядет батарея в портативном режиме. Для работы в докстанции или от зарядки, энергопотребление не так уж и важно.

## Проблемы и их решения

### Проблемы с батареей 

Аккумулятор не деградирует от силы тока, а только при достижении определенной температуры. Однако, встроенные механизмы защиты, основанные на законах физики, разрывают цепь питания, задолго до того, как достигнутые температуры успевают навредить аккумулятору, чтобы предотвратить деградацию химических свойств ячеек.

MARIKO оснащен контроллером PMIC MAX77812 рассчитанного на токи до 6A CPU / 12A GPU. Достиг лимита = ушел в защиту.
ERISTA оснащена более мощным контроллером PMICs MAX77621 на 16A CPU / 16A GPU.

Нагрузка свыше 15 ватт (примерно; точные значения лимитов тока для разных моделей консоли указаны в спецификациях производителя) может привести к снижению оценки остаточной ёмкости аккумулятора в консоли Nintendo Switch. Контроллер питания консоли сравнивает фактические показания с показаниями, которые были вбиты с завода, и в случае превышения дергает аварийное отключение. Консоль может считать, что аккумулятор не вывез, и снижает оценку его остаточной ёмкости, на 1% при каждом сбое. Это может привести к тому, что индикатор заряда консоли начинает мгновенно опускаться до 1% заряда, когда дается нагрузка на аккумулятор. Battery Desync Fix, может позволить вернуть списанную по ошибке ёмкость аккумулятора.

#### Батарея начала разряжаться до 1% со 100% за считаные минуты, однако без проблем работает на 1% несколько часов 

Контроллер питания рассчитан на пиковое потребление энергии примерно в 15W, если оно будет превышено, то консоль аварийно активирует защиту и выключится. Вам нужно снизить аппетиты, поскольку это влияет на данные калибровки контроллера. Консоль может считать, что аккумулятор не вывез, и снизить оценку его остаточной ёмкости, на 1% при каждом сбое. Это может привести к тому, что индикатор заряда консоли начинает мгновенно опускаться до 1% заряда, когда дается нагрузка на аккумулятор. Для решения этой проблемы существует [Battery Desync Fix NX](https://github.com/CTCaer/battery_desync_fix_nx). 

**ВНИМАНИЕ!!!** Не запускайте [Battery Desync Fix NX](https://github.com/CTCaer/battery_desync_fix_nx), если у вас нет проблем с батареей, иначе они появятся! Вам нужно будет делать отдельную калибровку для стока и каждого вашего эмунанда отдельно, поскольку данные о калибровке хранятся отдельно в каждом из них! 

Для сброса статистика батареи:
1. Разрядите батарею до выключения приставки, и включите ее обратно (можно от кабеля)
   * Если приставка засыпает из-за низкого заряда, будите её, пока не увидите красный значок батареи
1. Запустите [Battery Desync Fix NX](https://github.com/CTCaer/battery_desync_fix_nx)
1. Нажмите (X), чтобы сбросить статистику
1. Нажмите (B), чтобы выйти из приложения 
1. Полностью зарядите и разрядите приставку дважды
   * Под полной разрядкой подразумевается уровень зарадя батареи в пределах 3205-3210mV, посмотреть можно в InfoNX ([подробнее..](https://t.me/kefir_switch/48074/172575))
   * Не переключайтесь между сиснандом и эмунандами пока не закончите два цикла зарядки\разрядки, поскольку прошивка восстановит прежние значения калибровки батареи, что нам не нужно, и придется начинать все с начала
   * Если приставка выключилась из-за низкой батареи (перестает просыпаться от нажатия на кнопку питания), подключите к ней зарядник. Если приставка после этого висит на черном экране со значком батареи, отключите\подключите зарядку. Делайте так, пока не сможете снова зайти в прошивку и уже в ней заряжайте приставку до 100%, после чего повторите цикл разрядка\зарядка еще раз
   * Не оставляйте приставку заряжаться в черном экране со значком батареи, иначе прошивка восстановит прежние значения калибровки батареи, что нам не нужно, и придется начинать все с начала
1. После того как вы откалибровали батарею в эмунанде, проделайте все так же для сиснанда. 

#### При игре с включенным разгоном через некоторое время показывается значок пустой батареи 

Контроллер питания рассчитан на пиковое потребление энергии примерно в 15W, если оно будет превышено, то консоль аварийно активирует защиту и выключится. Это и происходит. Вероятно, вы привысили установленный в контроллере порог. Умерьте пыл и сбавьте значения частот. 

#### Игра перестала запускаться и стала вылетать 

Первым делом попробуйте удалить профиль этой игры от FPSLocker, вероятно вы отключили Sync Wait не убедившись в его безопасности. Профиль находится в `SaltySD/plugins/FPSLocker/TITLEID.dat`. Title игры можно посмотреть в **DBI** > **Browse Installed**

#### Не запускается Ведьмак 3/Resident Evil Revelations

**HB Menu** > **SysDVR** > **DVR-Patches** > **Uninstall** > **Reboot**
Если нету SysDVR-conf, его можно скачать в Updater

#### FPS в игре всегда показывает 0/254 или ReverseNX не переключает режимы

Вероятна ваша игра не совместима с **SaltyNX**, который отвечает за работу эти функций. Список несовместимых игр находится [здесь](https://github.com/masagrator/SaltyNX#list-of-titles-not-compatible-with-pluginspatches)

## FAQ 

**В**: Как использование разгона влияет на срок службы батареи            
**О**: Если коротко, то никак. 

**В**: Моя батарея деградировала            
**О**: Она не деградировала. У нее сбилась калибровка. Вернуть заводскую емкость батареи можно по инструкции выше 

**В**: Свитч выключается при использовании разгона            
**О**: Вероятно, у вас не тянет значения, которые вы задали. Пробуйте их понизить

**В**: Свитч разряжается до 1% со 100 за 10 минут            
**О**: Смотрите выше в разделе Проблемы и решения 

**В**: Нет говернора            
**О**: Если у вас 16.1 HOS, зайдите в Tuner - Updater и найдите переключатель sys-clk, выберите Old Full. Если 17 HOS - ждите, когда-нибудь портируют говернор и на нее

**В**: Частоты прыгают            
**О**: При работе говернора так и должно быть

**В**: Не могу удалить аккаунт            
**О**: **DBI** > **Tools** > **Delete account...**


## Лицензии

Ниже перечислены лицензии тех программ, которые были модифицированы специально для Ultra. Следуя положениям этих лицензий, весь код в модификациях распространяется под той же лицензией

[GPL 2.0](https://github.com/Atmosphere-NX/Atmosphere/blob/master/LICENSE): 
  * [Atmosphere](https://github.com/Atmosphere-NX/Atmosphere)
  * [Hekate](https://github.com/CTCaer/hekate)
  * [Status-Monitor-Overlay](https://github.com/masagrator/Status-Monitor-Overlay)
  * [Switch-OC-Suite](https://github.com/hanai3Bi/Switch-OC-Suite)

[CC-BY-NC-4.0 License](https://github.com/ppkantorski/Ultrahand-Overlay/blob/main/LICENSE)
  * [Ultrahand-Overlay](https://github.com/ppkantorski/Ultrahand-Overlay)

## Благодарности 

* Cooler3D
* Efosamark
* rashevskyv/хНЯ
* snupt/Catcher In The Grain Field
* ppkantorski/b0rd2dEAth
* hanai3Bi/Meha
* 4PDA

## Поддержка

Если вам понравились результаты моих стараний, и у вас появилось желание закинуть мне на шаурму - я буду очень благодарен.
* Сделать это можно через @wallet telegram, на мой аккаунт @redraz
* Либо через Сбер: 2202200513345833
* Так же по QR через Tinkoff
![](https://github.com/Ultra-NX/Ultra-Resources/raw/main/Tinkoff.png)